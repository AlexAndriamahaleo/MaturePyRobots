{% extends "base.html" %}

{% load staticfiles %}

{% block title %}
    PyRobot - Editeur
{% endblock %}

{% block custom_css %}
    <!-- Editeur Python CSS -->
    <link rel="stylesheet" href="{% static 'codemirror/lib/codemirror.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/theme/dracula.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/theme/cobalt.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/theme/rubyblue.css' %}"/>
    <!-- CodeMirror Autocomplete-->
    <link rel="stylesheet" href="{% static 'codemirror/addon/dialog/dialog.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/addon/search/matchesonscrollbar.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/addon/hint/show-hint.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/addon/tern/tern.css' %}"/>
    <link rel="stylesheet" href="{% static 'codemirror/addon/fold/foldgutter.css' %}"/>


    <style>
        .btn:hover {
            background-color: #388e3c;
        }

        .collection .collection-item.active .secondary-content {
            color: #1a237e;
        }

        .secondary-content {
            color: #b71c1c;
        }

        span.badge.new {
            font-weight: 300;
            font-size: 1.25rem;
            color: #fff176;
            background-color: #1a237e;
            border-radius: 20px;
        }

        blockquote {
            margin: 20px 0;
            padding-left: 1.5rem;
            border-left: 10px solid #fff176;
            border-left-width: 10px;
            border-left-style: solid;
            border-left-color: rgb(255, 241, 118);
        }
    </style>
{% endblock %}

{% block content %}

    <div class="col s12 m4 l3">
        <ul class="collapsible" data-collapsible="accordion">
            <li>
                <div class="collapsible-header active"><h4><i class="material-icons">code</i>Vos codes</h4>
                </div>
                <div class="collapsible-body">
                    <ul class="collection">
                        {% for script in scripts %}
                            <li class="collection-item {% if script.pk == selected.pk %} active {% endif %}">
                                <div class="black-text">
                                    {{ script.name|truncatechars:20 }}
                                    <a href="{% url 'backend:editor' %}?script={{ script.pk }}"
                                       class="script-1 secondary-content tooltipped" data-position="right"
                                       data-delay="50"
                                       data-tooltip="Charger le code"><i class="fas fa-exchange-alt fa-lg"></i></a>
                                </div>
                            </li>
                        {% endfor %}

                        {% if scripts_count < 5 %}
                            <li class="collection-item {{ addnew }}">
                                <a href="{% url 'backend:editor' %}?addnew=yes" class="tooltipped indigo-text darken-4"
                                   data-position="right" data-delay="50" data-tooltip="Nouveau code"><i
                                        class="fas fa-download fa-lg"></i></a>
                            </li>
                        {% endif %}
                    </ul>

                    {% if addnew %}
                        <form id="load" name="form_input" enctype="multipart/form-data">
                            <div class="file-field input-field">
                                <div class="btn indigo darken-4">
                                    <span>Parcourir..</span><i class="material-icons right">search</i>
                                    <input id="myfile" type="file">
                                </div>
                                <div class="file-path-wrapper">
                                    <input id="name_file" class="file-path validate" type="text">
                                    <button id="entrer" class="btn waves-effect waves-light indigo darken-4"
                                            type="button">Charger
                                        <i class="material-icons right">file_download</i>
                                    </button>

                                </div>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </li>
            <li>
                <div class="collapsible-header"><h5><i class="material-icons">info</i>Informations</h5></div>
                <div class="collapsible-body">
                    <ul class="collection">
                        <li class="collection-item">
                            <p>
                                Votre objectif ? Détruire le tank adverse.
                            </p>
                        </li>
                        <li class="collection-item">
                            <p>
                                Vos tanks ont les mêmes capacités ! <br/>
                                L'issue du combat se joue donc sur la <br/>
                                manière dont vous programmez le vôtre.
                            </p>
                        </li>
                        <li class="collection-item">
                            <p>
                                Pour gagner il faut toucher 7 fois.
                            </p>
                        </li>
                        <li class="collection-item">
                            <p>
                                Pour y parvenir vous avez 4 Points d'Actions (PA).
                                Ils vous permettent de vous déplacer <br/>
                                mais aussi de tirer sur le tank adverse. <br/>
                                Un mouvement ou un tir coûte 1 PA. <br/><br/>
                                Utilisez les à bon escient !
                            </p>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="hide-on-med-and-down">
                <div class="collapsible-header"><h5><i class="material-icons">keyboard</i>Astuces</h5></div>
                <div class="collapsible-body">
                    <ul class="collection">
                        <li class="collection-item">
                            <p>
                                Afin de faciliter votre expérience. Nous avons intégrés des raccourcis claviers.
                            </p>
                        </li>
                        <li class="collection-item">Autocomplétion: <br/>Ctrl-Space / Opt-F</li>
                        <li class="collection-item">Recherche dans le code: <br/>Ctrl-F / Cmd-F</li>
                        <li class="collection-item">Recherche & Remplace dans le code: <br/>Shift-Ctrl-F / Cmd-Opt-F
                        </li>
                        <li class="collection-item">Recherche & Remplace toute occurrence dans le code: <br/>Shift-Ctrl-R
                            / Shift-Cmd-Opt-F
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
        <blockquote>
            <i class="fa fa-exclamation-triangle fa-lg tooltipped" data-position="left"
               data-delay="50" data-tooltip="Attention" aria-hidden="true"></i> S'il venait à y
            avoir une erreur, veillez à
            bien vérifier le code que vous avez écrit.
        </blockquote>

    </div>

    <div class="col s12 m8 l9">

        <form id="code" action="{% url 'backend:editor' %}" method="post">
            {% csrf_token %}

            <div class="col s12 m12 l12 ">
                Nom de ton IA:
                <div class="input-field inline">
                    <input id="code_name" type="text" name="ai_name"
                           value="{% if temporary_name %}{{ temporary_name }}{% else %}{{ selected.name }}{% endif %}"
                           placeholder="Nom de IA"/>

                </div>
                <span class="new badge" data-badge-caption="{{ active_script.name }}">Active AI: </span>

                <nav>
                    <div class="nav-wrapper yellow lighten-2">
                        <ul class="left hide-on-med-and-down">
                            <li class="save hoverable" value="Sauvegarder">
                                <!--<a id="coucou_save" type="submit" class="indigo-text darken-4">
                                    SAUVEGARDER
                                </a>-->
                                <input id="coucou_save" type="submit" class="btn-flat indigo-text darken-4" name="action"
                                       value="Sauvegarder">
                            </li>
                            <li class="save hoverable" value="Activer">
                                <!--<a id="coucou_active" type="submit" class="indigo-text darken-4">
                                    ACTIVER
                                </a>-->
                                <input type="submit" class="btn-flat indigo-text darken-4" name="action"
                                       value="Activer">
                            </li>
                            <li>
                                <a class="indigo-text darken-4" href="{% url 'backend:versus' %}">TESTER</a>
                            </li>
                            <li>
                                <a class="indigo-text darken-4" onclick="window.location.href='/battle'">COMBATTRE
                                    [dev]</a>
                                <!-- TODO: remove this button after CPU script dev -->
                            </li>
                        </ul>
                        <ul class="side-nav" id="mobile-demo">
                            <li class="save">
                                <input type="submit" class="btn-flat indigo-text darken-4" name="action"
                                       value="Sauvegarder">
                            </li>
                            <li class="save">
                                <input type="submit" class="btn-flat indigo-text darken-4" name="action"
                                       value="Activer">
                            </li>
                            <li>
                                <a class="waves-effect" href="{% url 'backend:versus' %}"><i
                                        class="material-icons left">cached</i>Tester</a>
                            </li>
                        </ul>
                        <a href="#" data-activates="mobile-demo" class="button-collapse"><i
                                class="material-icons">menu</i></a>
                    </div>
                </nav>

                <textarea name="ia" id="ia" cols="40" rows="12">{% if temporary_text %}
                    {{ temporary_text }}{% else %}{{ selected.text }}{% endif %}</textarea>
                <label for="ia">Code</label>

                {% if addnew %}
                    <input type="hidden" name="addnew_flag" value="yes"/>
                {% else %}
                    <input type="hidden" name="selected_pk" value="{{ selected.pk }}"/>
                {% endif %}




                <!--p><strong style="font-weight: bold">Active AI:</strong> {{ active_script.name }}</p>-->
            </div>
        </form>
    </div>

{% endblock %}

{% block custom_js %}
    <script src="{% static 'codemirror/lib/codemirror.js' %}"></script>
    <script src="{% static 'codemirror/mode/python/python.js' %}"></script>
    <script src="{% static 'codemirror/addon/dialog/dialog.js' %}"></script>
    <script src="{% static 'codemirror/addon/search/searchcursor.js' %}"></script>
    <script src="{% static 'codemirror/addon/search/search.js' %}"></script>
    <script src="{% static 'codemirror/addon/scroll/annotatescrollbar.js' %}"></script>
    <script src="{% static 'codemirror/addon/search/matchesonscrollbar.js' %}"></script>
    <script src="{% static 'codemirror/addon/search/jump-to-line.js' %}"></script>
    <script src="{% static 'codemirror/addon/hint/show-hint.js' %}"></script>
    <script src="{% static 'codemirror/addon/tern/tern.js' %}"></script>



    <script src="{% static 'tern/acorn.js' %}"></script>
    <script src="{% static 'tern/acorn_loose.js' %}"></script>
    <script src="{% static 'tern/walk.js' %}"></script>
    <script src="{% static 'tern/polyfill.js' %}"></script>
    <script src="{% static 'tern/signal.js' %}"></script>
    <script src="{% static 'tern/tern.js' %}"></script>
    <script src="{% static 'tern/def.js' %}"></script>
    <script src="{% static 'tern/comment.js' %}"></script>
    <script src="{% static 'tern/infer.js' %}"></script>
    <script src="{% static 'tern/doc_comment.js' %}"></script>

    <!--<script src="https://ternjs.net/node_modules/acorn/dist/acorn.js"></script>
    <script src="https://ternjs.net/node_modules/acorn/dist/acorn_loose.js"></script>
    <script src="https://ternjs.net/node_modules/acorn/dist/walk.js"></script>
    <script src="https://ternjs.net/doc/demo/polyfill.js"></script>
    <script src="https://ternjs.net/lib/signal.js"></script>
    <script src="https://ternjs.net/lib/tern.js"></script>
    <script src="https://ternjs.net/lib/def.js"></script>
    <script src="https://ternjs.net/lib/comment.js"></script>
    <script src="https://ternjs.net/lib/infer.js"></script>
    <script src="https://ternjs.net/plugin/doc_comment.js"></script>-->

    <script src="{% static 'js/editor.js' %}"></script>
    <script src="{% static 'codemirror/addon/edit/closebrackets.js' %}"></script>
    <script src="{% static 'codemirror/addon/edit/matchbrackets.js' %}"></script>
    <script src="{% static 'codemirror/addon/hint/python-hint.js' %}"></script>
    <script src="{% static 'codemirror/addon/tern/worker.js' %}"></script>
    <script src="{% static 'codemirror/addon/wrap/hardwrap.js' %}"></script>
    <script src="{% static 'codemirror/addon/fold/brace-fold.js' %}"></script>
    <script src="{% static 'codemirror/addon/fold/foldcode.js' %}"></script>
    <script src="{% static 'codemirror/addon/fold/indent-fold.js' %}"></script>
    <script src="{% static 'codemirror/addon/fold/foldgutter.js' %}"></script>
    <script src="{% static 'codemirror/addon/fold/comment-fold.js' %}"></script>
    <script src="{% static 'codemirror/keymap/sublime.js' %}"></script>
    <script type="text/javascript">
        var code = "{{ temporary_text }}";

    //onclick="document.getElementById('code').submit()


    </script>
{% endblock %}
