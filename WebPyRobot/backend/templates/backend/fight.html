{% extends 'base.html' %}

{% load static %}

{% block title %} PyRobot - Combat {% endblock %}

{% block custom_css %}
    <style>
        #canvas{
            max-width: 100%;
            height: auto;
        }
    </style>

{% endblock %}

{% block content %}
    <div class="container">
        {% if battle_err %}
            <div class="col s12 m9 l10 pad">
                <div class="row z-depth-1 section padding-section" id="show_str"></div>
            </div>
        {% else %}
            <div class="col s12 m9 l10 pad">
                <div class="row z-depth-1 section padding-section">
                    <div class="card-panel yellow lighten-2">
                    <span id="win" class="indigo-text darken-4">
                        Bataille en cours...
                    </span>
                    </div>

                    <canvas class="materialboxed col l8 offset-l2" id="canvas"></canvas>

                    <div class="col l8 offset-l2">&nbsp;</div>

                    <div class="col l8 offset-l2">
                        {% if not is_replay %}
                            <div class="row">
                                <div id="editer" class="col s12 m6 l6">
                                    <a id="logo-container" style="cursor:pointer" href="#pause"
                                       class="waves-effect waves-light btn indigo darken-4 yellow-text modal-trigger">
                                        <i class="material-icons left">pause_circle_outline</i>Pause</a>
                                </div>
                                <div class="col s12 m6 l6">
                                    <form action="{% url 'backend:finish_battle' %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="history_pk" value="{{ history_pk }}"/>
                                        <input type="hidden" name="mode" value="{{ is_versus }}"/>
                                        <div id="fincombat">
                                            <input class="waves-effect waves-light btn indigo darken-4 yellow-text finish"
                                                   type="submit" value="Terminer le combat"/>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                </div>
            </div>
            <div id="pause" class="modal modal-fixed-footer">
        <div class="modal-content">
            <h4>Pause</h4>
            <p>Vous êtes sur le point de mettre votre battle sur [PAUSE].</p>
            <p>Vous allez retourner à la page d'accueil.</p>
            <p>
                Tant que le combat ne sera pas terminé vous ne pourrez pas démarrer d'autre battle (en mode VERSUS
                ou en mode CHAMPIONNAT) face à un autre joueur.
            </p>
            <p>Cliquer sur terminer le combat pour voir le résultat de la battle sans attendre la fin de l'animation.</p>
        </div>
        <div class="modal-footer">
            <a onclick="window.history.go(-1)" class="modal-action modal-close waves-effect waves-green btn-flat ">Continuer</a>
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Retour</a>
        </div>
    </div>
        {% endif %}
    </div>
{% endblock %}

{% block custom_js %}
    {% if not battle_err %}
        <script type="text/javascript">
            var a = "{{ result }}".replace(/&#39;/g, "\"");
            var opponent = "{{ opponent }}";
            var playername = "{{ request.user.username }}";
            var player_x = {{ player_x }};
            var player_y = {{ player_y }};
            var opponent_x = {{ opponent_x }};
            var opponent_y = {{ opponent_y }};
            var step_index = {{ step }};
            var map_name = "{{ map_name }}";
            var is_replay = "{{ is_replay }}";
            var is_versus = "{{ is_versus }}"
        </script>
        {% include 'backend/headAnimation.html' %}
    {% endif %}
{% endblock %}
